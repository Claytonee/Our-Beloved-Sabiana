<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Happy Birthday Jenipher ðŸŽ‰</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* ====== MABORESHO YA CSS ====== */
  :root{
    --pink:#fcd4e0;
    --lav:#e0d4fc;
    --ink:#333;
    --rose:#c54b8c;
    --night-bg-dark:#04060f;
    --night-bg-light:#0b1022;
    --night-text:#eaeaf6;
    --night-rose:#ffd1f0;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--ink);
    background: linear-gradient(135deg, var(--pink), var(--lav));
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    transition: background 1.2s ease, color .6s ease;
    overflow:hidden;
  }
  body.night{
    background: radial-gradient(1200px 600px at 50% -10%, rgba(255,255,255,.06), transparent 60%),
                linear-gradient(180deg, var(--night-bg-light), var(--night-bg-dark) 70%);
    color:var(--night-text);
  }
  .container{
    background:#fff;
    color:#333;
    padding:22px;
    border-radius:22px;
    box-shadow: 0 14px 40px rgba(0,0,0,.12);
    text-align:center;
    max-width:560px;
    width:min(92vw, 560px);
    transition: transform .4s ease, background .4s ease, color .4s ease, opacity .6s ease;
    z-index:20;
    position:relative;
  }
  .fade-out{
    opacity:0 !important;
    transform: translateY(10px) scale(.995);
    pointer-events:none;
  }
  body.night .container{
    background: rgba(255,255,255,.08);
    color:var(--night-text);
    backdrop-filter: blur(6px);
    border:1px solid rgba(255,255,255,.12);
  }
  h1{ color:var(--rose); margin-top:0 }
  body.night h1{ color:var(--night-rose) }
  button{
    background: linear-gradient(135deg, #fba0c6, #d8b4fe);
    border:none;
    color:#fff;
    padding:12px 20px;
    border-radius:999px;
    font-size:1rem;
    cursor:pointer;
    transition: transform .15s ease, box-shadow .15s ease;
    margin-top:14px;
    box-shadow: 0 10px 20px rgba(207, 138, 216, .35);
  }
  button:hover{ transform: translateY(-1px) }
  button:active{ transform: scale(.98) }
  
  .hidden{ display:none !important; }
  .stack{ display:grid; gap:14px; }
  .opt-row button{ margin: 6px }

  /* Canvas (fireworks only) */
  #sky{
    position:fixed;
    inset:0;
    width:100vw;
    height:100vh;
    pointer-events:none;
    z-index:5;
  }

  /* Tiny progress dots (hatua) */
  .steps{ display:flex; justify-content:center; gap:8px; margin-top:8px }
  .dot{ width:8px; height:8px; border-radius:50%; background:#e5e7eb; }
  .dot.active{ background:#c54b8c }
  body.night .dot{ background:#223 }
  body.night .dot.active{ background:#ffd1f0 }

  /* New: Styled Text */
  .final-text{
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    z-index: 10;
    text-align: center;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1s ease, transform 1s ease;
  }
  .final-text h2{
    font-size: clamp(3rem, 10vw, 5rem);
    font-weight: 700;
    line-height: 1.2;
    margin: 0;
    color: var(--night-rose);
    text-shadow: 0 0 10px rgba(255,209,240,.6);
  }
  .final-text.visible{
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  .final-text.hidden-text{
    display: none;
  }

</style>
</head>
<body>

<canvas id="sky"></canvas>

<div class="container" id="step1">
  <h1>ðŸŽ‚ Happy Birthday Jenipher ðŸŽ‚</h1>
  <p>Leo ni siku yako maalum, Boss wetu mpendwa!
  Karibu kwenye safari ya hatua 4 za sherehe ðŸŽ‰</p>
  <button onclick="nextStep(2)">Anza Sherehe âžœ</button>
  <div class="steps"><span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
</div>

<div class="container hidden" id="step2">
  <h1>ðŸŒ¸ Hatua ya 2 ðŸŒ¸</h1>
  <p>Chagua emoji inayokuonyesha furaha yako leo:</p>
  <div class="opt-row">
    <button onclick="selectEmoji('ðŸ’–')">ðŸ’–</button>
    <button onclick="selectEmoji('ðŸŽ‰')">ðŸŽ‰</button>
    <button onclick="selectEmoji('ðŸŒ¹')">ðŸŒ¹</button>
    <button onclick="selectEmoji('âœ¨')">âœ¨</button>
  </div>
  <button onclick="nextStep(1)" style="background:#e5e7eb;color:#333">âŸµ Rudi</button>
  <div class="steps"><span class="dot"></span><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
</div>

<div class="container hidden" id="step3">
  <h1>ðŸ’Œ Hatua ya 3 ðŸ’Œ</h1>
  <p>Chagua neno linalokuelezea:</p>
  <div class="stack">
    <button onclick="selectWord('Mwenye moyo wa upendo')">Mwenye moyo wa upendo</button>
    <button onclick="selectWord('Kiongozi mwenye maono')">Kiongozi mwenye maono</button>
    <button onclick="selectWord('Mwenye faraja')">Mwenye faraja</button>
    <button onclick="selectWord('Msikivu na mwenye hekima')">Msikivu na mwenye hekima</button>
  </div>
  <button onclick="nextStep(2)" style="background:#e5e7eb;color:#333">âŸµ Rudi</button>
  <div class="steps"><span class="dot"></span><span class="dot"></span><span class="dot active"></span><span class="dot"></span></div>
</div>

<div class="container hidden" id="step4">
  <h1>ðŸŽŠ Hatua ya Mwisho ðŸŽŠ</h1>
  <p id="finalMessage">ðŸ’– Jenipher mpendwa, wewe ni Mwenye moyo wa upendo.<br>
  Umenisaidia sana tangu nianze EnterSoft Systems Ltdâ€”uliniinua wakati wa magumu na kunijali kwa dhati.<br>
  Nakutakia maisha marefu, furaha tele na baraka zisizo na kipimo.<br>
  Happy Birthday! ðŸ’–</p>
  <button id="finaleBtn" onclick="startFinale()">Piga Sherehe ðŸŽ†</button>
  <div class="steps"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
</div>

<div id="finalText" class="final-text hidden-text">
  <h2>Happy Birthday Jenipher</h2>
</div>

<script>
  /* ======= MABORESHO YA JAVASCRIPT: LOGIC YA FLOW ======= */
  let chosenEmoji = '';
  let chosenWord = '';
  const stepEls = [1,2,3,4].map(n=>document.getElementById('step'+n));
  function setDots(step){
    document.querySelectorAll('.steps').forEach(group=>{
      const dots = [...group.querySelectorAll('.dot')];
      dots.forEach(d=>d.classList.remove('active'));
      if(dots[step-1]) dots[step-1].classList.add('active');
    });
  }
  function nextStep(step){
    stepEls.forEach(el=>el.classList.add('hidden'));
    document.getElementById('step'+step).classList.remove('hidden');
    setDots(step);
    window.scrollTo({top:0, behavior:'smooth'});
  }
  function selectEmoji(e){ chosenEmoji = e; nextStep(3); }
  function selectWord(w){
    chosenWord = w;
    const msg = `${chosenEmoji} Jenipher mpendwa, wewe ni ${chosenWord}.<br>
      Umenisaidia sana tangu nianze EnterSoft Systems Ltdâ€”uliniinua wakati wa magumu na kunijali kwa dhati.<br>
      Nakutakia maisha marefu, furaha tele na baraka zisizo na kipimo.<br>
      Happy Birthday! ${chosenEmoji}`;
    document.getElementById('finalMessage').innerHTML = msg;
    nextStep(4);
  }

  /* ======= MABORESHO YA JAVASCRIPT: CANVAS (Sasa ni za Fireworks tu) ======= */
  const sky = document.getElementById('sky');
  const c = sky.getContext('2d');
  let W = sky.width = window.innerWidth;
  let H = sky.height = window.innerHeight;
  window.addEventListener('resize', ()=>{
    W = sky.width = window.innerWidth;
    H = sky.height = window.innerHeight;
  });

  /* ======= STARFIELD (night mood) ======= */
  let stars = [];
  function makeStars(n=180){
    stars = [];
    for(let i=0;i<n;i++){
      stars.push({
        x: Math.random()*W, y: Math.random()*H,
        r: Math.random()*1.2 + .2,
        tw: Math.random()*100 + 40
      });
    }
  }
  function drawStars(t){
    c.save();
    for(const s of stars){
      const a = .4 + Math.sin((t/s.tw))*0.4;
      c.globalAlpha = a;
      c.fillStyle = '#fff';
      c.beginPath(); c.arc(s.x, s.y, s.r, 0, Math.PI*2); c.fill();
    }
    c.restore(); c.globalAlpha = 1;
  }

  /* ======= FIREWORKS ======= */
  const GRAVITY = 0.06;
  let rockets = [];
  let sparks = [];

  function spawnRocket(x, targetY){
    rockets.push({
      x, y: H+10,
      vx: (Math.random()*2 - 1)*0.6,
      vy: -(6 + Math.random()*2.5),
      color: `hsl(${Math.random()*360},100%,60%)`,
      explodeY: targetY || (H*0.25 + Math.random()*H*0.35)
    });
  }
  function updateRockets(){
    const next=[];
    for(const r of rockets){
      r.x += r.vx; r.y += r.vy; r.vy += GRAVITY*0.25;
      sparks.push({x:r.x, y:r.y, vx:(Math.random()-.5)*.6, vy:(Math.random()-.5)*.6, life:20+Math.random()*10, color:r.color, size:1.2});
      if(r.y <= r.explodeY){
        explode(r.x, r.y, r.color);
      } else next.push(r);
    }
    rockets = next;
  }
  function explode(x, y, baseColor){
    const N = 60 + Math.floor(Math.random()*50);
    for(let i=0;i<N;i++){
      const angle = (Math.PI*2)*i/N;
      const speed = 1.8 + Math.random()*3.2;
      sparks.push({
        x, y,
        vx: Math.cos(angle)*speed + (Math.random()-.5)*.6,
        vy: Math.sin(angle)*speed + (Math.random()-.5)*.6,
        life: 50 + Math.random()*40,
        color: Math.random()<.4 ? baseColor : `hsl(${Math.random()*360},100%,60%)`,
        size: 1.6 + Math.random()*1.6,
        glow: true
      });
    }
  }
  function updateSparks(){
    const next=[];
    for(const s of sparks){
      s.life -= 1;
      s.x += s.vx; s.y += s.vy;
      s.vy += GRAVITY;
      s.vx *= 0.995; s.vy *= 0.995;
      if(s.life>0 && s.y<H+20) next.push(s);
    }
    sparks = next;
  }
  function drawSparks(){
    c.save();
    for(const s of sparks){
      const a = Math.max(0, Math.min(1, s.life/60));
      c.globalAlpha = a;
      if(s.glow){
        c.shadowBlur = 12; c.shadowColor = s.color;
      } else {
        c.shadowBlur = 0;
      }
      c.fillStyle = s.color;
      c.beginPath(); c.arc(s.x, s.y, s.size, 0, Math.PI*2); c.fill();
    }
    c.restore(); c.globalAlpha = 1;
  }

  /* ======= FINALE CONTROLLER ======= */
  let running=false, t0=0, finaleStage='idle', finaleTimer=0;
  const finalTextEl = document.getElementById('finalText');

  function hideAllUIThen(fn){
    const all = document.querySelectorAll('.container');
    all.forEach(el=>{
      el.classList.add('fade-out');
    });
    setTimeout(()=>{
      all.forEach(el=>el.classList.add('hidden'));
      if(typeof fn === 'function') fn();
    }, 650);
  }

  function startFinale(){
    hideAllUIThen(()=>{
      document.body.classList.add('night');
      makeStars();
      finalTextEl.classList.remove('hidden-text');
      // Subiri kidogo kisha anza sherehe
      setTimeout(()=>{
        finalTextEl.classList.add('visible');
        finaleStage = 'barrage'; // ANZA STAGE YA FIREWORKS HAPA!
        running = true;
        finaleTimer = 0;
        t0 = performance.now();
      }, 1500); // 1.5 sekunde kabla fireworks kuanza
    });
  }

  function loop(now){
    const elapsed = now - (t0 || now);
    if(!running){
      requestAnimationFrame(loop);
      return;
    }
    t0 = now;
    c.clearRect(0,0,W,H);
    drawStars(now/16);

    if(finaleStage==='barrage'){
      if(Math.random()<0.16) spawnRocket(Math.random()*W);
      updateRockets(); drawSparks(); updateSparks();
      finaleTimer += elapsed;
      if(finaleTimer>6000){
        finaleStage='grand'; finaleTimer=0;
        for(let i=0;i<6;i++){
          const x = (i+1)*(W/7);
          spawnRocket(x, H*0.3 + Math.random()*H*0.15);
        }
      }
    } else if(finaleStage==='grand'){
      if(Math.random()<0.26) spawnRocket(Math.random()*W);
      updateRockets(); drawSparks(); updateSparks();
      finaleTimer += elapsed;
      if(finaleTimer>6000){ finaleStage='calm'; }
    } else if(finaleStage==='calm'){
      if(Math.random()<0.04) spawnRocket(Math.random()*W, H*0.4 + Math.random()*H*0.2);
      updateRockets(); drawSparks(); updateSparks();
    }

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  window.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState === 'visible' && finalStageActive()) {
      running = true;
    }
  });

  function finalStageActive(){ return finaleStage !== 'idle'; }

  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' && !finalStageActive()){
      const b = document.getElementById('finaleBtn');
      if(b) b.click();
    }
  });

  makeStars();

  window.startFinale = startFinale;
  window.nextStep = nextStep;
  window.selectEmoji = selectEmoji;
  window.selectWord = selectWord;

</script>
</body>
</html>